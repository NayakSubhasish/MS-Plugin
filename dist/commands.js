/*! For license information please see commands.js.LICENSE.txt */
!function(){var e,t,o={64583:function(e,t,o){e.exports=function(){"use strict";function e(e){return"function"==typeof e}var t=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},n=0,i=void 0,r=void 0,a=function(e,t){g[n]=e,g[n+1]=t,2===(n+=2)&&(r?r(p):w())};var s="undefined"!=typeof window?window:void 0,l=s||{},c=l.MutationObserver||l.WebKitMutationObserver,u="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),d="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function f(){var e=setTimeout;return function(){return e(p,1)}}var g=new Array(1e3);function p(){for(var e=0;e<n;e+=2)(0,g[e])(g[e+1]),g[e]=void 0,g[e+1]=void 0;n=0}var m,h,v,y,w=void 0;function b(e,t){var o=this,n=new this.constructor(O);void 0===n[A]&&R(n);var i=o._state;if(i){var r=arguments[i-1];a((function(){return L(i,n,r,o._result)}))}else C(o,n,e,t);return n}function E(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(O);return T(t,e),t}w=u?function(){return process.nextTick(p)}:c?(h=0,v=new c(p),y=document.createTextNode(""),v.observe(y,{characterData:!0}),function(){y.data=h=++h%2}):d?((m=new MessageChannel).port1.onmessage=p,function(){return m.port2.postMessage(0)}):void 0===s?function(){try{var e=Function("return this")().require("vertx");return void 0!==(i=e.runOnLoop||e.runOnContext)?function(){i(p)}:f()}catch(e){return f()}}():f();var A=Math.random().toString(36).substring(2);function O(){}var I=void 0,x=1,k=2;function S(t,o,n){o.constructor===t.constructor&&n===b&&o.constructor.resolve===E?function(e,t){t._state===x?P(e,t._result):t._state===k?M(e,t._result):C(t,void 0,(function(t){return T(e,t)}),(function(t){return M(e,t)}))}(t,o):void 0===n?P(t,o):e(n)?function(e,t,o){a((function(e){var n=!1,i=function(e,t,o,n){try{e.call(t,o,n)}catch(e){return e}}(o,t,(function(o){n||(n=!0,t!==o?T(e,o):P(e,o))}),(function(t){n||(n=!0,M(e,t))}),e._label);!n&&i&&(n=!0,M(e,i))}),e)}(t,o,n):P(t,o)}function T(e,t){if(e===t)M(e,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof(n=t),null===n||"object"!==i&&"function"!==i)P(e,t);else{var o=void 0;try{o=t.then}catch(t){return void M(e,t)}S(e,t,o)}var n,i}function _(e){e._onerror&&e._onerror(e._result),N(e)}function P(e,t){e._state===I&&(e._result=t,e._state=x,0!==e._subscribers.length&&a(N,e))}function M(e,t){e._state===I&&(e._state=k,e._result=t,a(_,e))}function C(e,t,o,n){var i=e._subscribers,r=i.length;e._onerror=null,i[r]=t,i[r+x]=o,i[r+k]=n,0===r&&e._state&&a(N,e)}function N(e){var t=e._subscribers,o=e._state;if(0!==t.length){for(var n=void 0,i=void 0,r=e._result,a=0;a<t.length;a+=3)n=t[a],i=t[a+o],n?L(o,n,i,r):i(r);e._subscribers.length=0}}function L(t,o,n,i){var r=e(n),a=void 0,s=void 0,l=!0;if(r){try{a=n(i)}catch(e){l=!1,s=e}if(o===a)return void M(o,new TypeError("A promises callback cannot return that same promise."))}else a=i;o._state!==I||(r&&l?T(o,a):!1===l?M(o,s):t===x?P(o,a):t===k&&M(o,a))}var j=0;function R(e){e[A]=j++,e._state=void 0,e._result=void 0,e._subscribers=[]}var D=function(){function e(e,o){this._instanceConstructor=e,this.promise=new e(O),this.promise[A]||R(this.promise),t(o)?(this.length=o.length,this._remaining=o.length,this._result=new Array(this.length),0===this.length?P(this.promise,this._result):(this.length=this.length||0,this._enumerate(o),0===this._remaining&&P(this.promise,this._result))):M(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===I&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var o=this._instanceConstructor,n=o.resolve;if(n===E){var i=void 0,r=void 0,a=!1;try{i=e.then}catch(e){a=!0,r=e}if(i===b&&e._state!==I)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(o===F){var s=new o(O);a?M(s,r):S(s,e,i),this._willSettleAt(s,t)}else this._willSettleAt(new o((function(t){return t(e)})),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,o){var n=this.promise;n._state===I&&(this._remaining--,e===k?M(n,o):this._result[t]=o),0===this._remaining&&P(n,this._result)},e.prototype._willSettleAt=function(e,t){var o=this;C(e,void 0,(function(e){return o._settledAt(x,t,e)}),(function(e){return o._settledAt(k,t,e)}))},e}();var F=function(){function t(e){this[A]=j++,this._result=this._state=void 0,this._subscribers=[],O!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){T(e,t)}),(function(t){M(e,t)}))}catch(t){M(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var o=this,n=o.constructor;return e(t)?o.then((function(e){return n.resolve(t()).then((function(){return e}))}),(function(e){return n.resolve(t()).then((function(){throw e}))})):o.then(t,t)},t}();return F.prototype.then=b,F.all=function(e){return new D(this,e).promise},F.race=function(e){var o=this;return t(e)?new o((function(t,n){for(var i=e.length,r=0;r<i;r++)o.resolve(e[r]).then(t,n)})):new o((function(e,t){return t(new TypeError("You must pass an array to race."))}))},F.resolve=E,F.reject=function(e){var t=new this(O);return M(t,e),t},F._setScheduler=function(e){r=e},F._setAsap=function(e){a=e},F._asap=a,F.polyfill=function(){var e=void 0;if(void 0!==o.g)e=o.g;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=F},F.Promise=F,F}()}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var r=n[e]={exports:{}};return o[e].call(r.exports,r,r.exports,i),r.exports}i.m=o,i.d=function(e,t){for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.f={},i.e=function(e){return r.all(Object.keys(i.f).reduce((function(t,o){return i.f[o](e,t),t}),[]))},i.u=function(e){return e+".js"},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e={},t="office-addin-taskpane-react-js:",i.l=function(o,n,r,a){if(e[o])e[o].push(n);else{var s,l;if(void 0!==r)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==o||d.getAttribute("data-webpack")==t+r){s=d;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,i.nc&&s.setAttribute("nonce",i.nc),s.setAttribute("data-webpack",t+r),s.src=o),e[o]=[n];var f=function(t,n){s.onerror=s.onload=null,clearTimeout(g);var i=e[o];if(delete e[o],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((function(e){return e(n)})),t)return t(n)},g=setTimeout(f.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=f.bind(null,s.onerror),s.onload=f.bind(null,s.onload),l&&document.head.appendChild(s)}},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");if(o.length)for(var n=o.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=o[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e}(),function(){var e={217:0};i.f.j=function(t,o){var n=i.o(e,t)?e[t]:void 0;if(0!==n)if(n)o.push(n[2]);else{var a=new r((function(o,i){n=e[t]=[o,i]}));o.push(n[2]=a);var s=i.p+i.u(t),l=new Error;i.l(s,(function(o){if(i.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var r=o&&("load"===o.type?"missing":o.type),a=o&&o.target&&o.target.src;l.message="Loading chunk "+t+" failed.\n("+r+": "+a+")",l.name="ChunkLoadError",l.type=r,l.request=a,n[1](l)}}),"chunk-"+t,t)}};var t=function(t,o){var n,r,a=o[0],s=o[1],l=o[2],c=0;if(a.some((function(t){return 0!==e[t]}))){for(n in s)i.o(s,n)&&(i.m[n]=s[n]);l&&l(i)}for(t&&t(o);c<a.length;c++)r=a[c],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0},o=self.webpackChunkoffice_addin_taskpane_react_js=self.webpackChunkoffice_addin_taskpane_react_js||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var r=i(64583).Promise;function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function s(){"use strict";s=function(){return t};var e,t={},o=Object.prototype,n=o.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},l=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function d(e,t,o,n){return Object.defineProperty(e,t,{value:o,enumerable:!n,configurable:!n,writable:!n})}try{d({},"")}catch(e){d=function(e,t,o){return e[t]=o}}function f(t,o,n,i){var r=o&&o.prototype instanceof m?o:m,a=Object.create(r.prototype);return d(a,"_invoke",function(t,o,n){var i=1;return function(r,a){if(3===i)throw Error("Generator is already running");if(4===i){if("throw"===r)throw a;return{value:e,done:!0}}for(n.method=r,n.arg=a;;){var s=n.delegate;if(s){var l=I(s,n);if(l){if(l===p)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===i)throw i=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=3;var c=g(t,o,n);if("normal"===c.type){if(i=n.done?4:2,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=4,n.method="throw",n.arg=c.arg)}}}(t,n,new S(i||[])),!0),a}function g(e,t,o){try{return{type:"normal",arg:e.call(t,o)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var p={};function m(){}function h(){}function v(){}var y={};d(y,l,(function(){return this}));var w=Object.getPrototypeOf,b=w&&w(w(T([])));b&&b!==o&&n.call(b,l)&&(y=b);var E=v.prototype=m.prototype=Object.create(y);function A(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function o(i,r,s,l){var c=g(e[i],e,r);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==a(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){o("next",e,s,l)}),(function(e){o("throw",e,s,l)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return o("throw",e,s,l)}))}l(c.arg)}var i;d(this,"_invoke",(function(e,n){function r(){return new t((function(t,i){o(e,n,t,i)}))}return i=i?i.then(r,r):r()}),!0)}function I(t,o){var n=o.method,i=t.i[n];if(i===e)return o.delegate=null,"throw"===n&&t.i.return&&(o.method="return",o.arg=e,I(t,o),"throw"===o.method)||"return"!==n&&(o.method="throw",o.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var r=g(i,t.i,o.arg);if("throw"===r.type)return o.method="throw",o.arg=r.arg,o.delegate=null,p;var a=r.arg;return a?a.done?(o[t.r]=a.value,o.next=t.n,"return"!==o.method&&(o.method="next",o.arg=e),o.delegate=null,p):a:(o.method="throw",o.arg=new TypeError("iterator result is not an object"),o.delegate=null,p)}function x(e){this.tryEntries.push(e)}function k(t){var o=t[4]||{};o.type="normal",o.arg=e,t[4]=o}function S(e){this.tryEntries=[[-1]],e.forEach(x,this),this.reset(!0)}function T(t){if(null!=t){var o=t[l];if(o)return o.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function o(){for(;++i<t.length;)if(n.call(t,i))return o.value=t[i],o.done=!1,o;return o.value=e,o.done=!0,o};return r.next=r}}throw new TypeError(a(t)+" is not iterable")}return h.prototype=v,d(E,"constructor",v),d(v,"constructor",h),h.displayName=d(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,d(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},A(O.prototype),d(O.prototype,c,(function(){return this})),t.AsyncIterator=O,t.async=function(e,o,n,i,a){void 0===a&&(a=r);var s=new O(f(e,o,n,i),a);return t.isGeneratorFunction(o)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},A(E),d(E,u,"Generator"),d(E,l,(function(){return this})),d(E,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),o=[];for(var n in t)o.unshift(n);return function e(){for(;o.length;)if((n=o.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},t.values=T,S.prototype={constructor:S,reset:function(t){if(this.prev=this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var o in this)"t"===o.charAt(0)&&n.call(this,o)&&!isNaN(+o.slice(1))&&(this[o]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var o=this;function n(e){a.type="throw",a.arg=t,o.next=e}for(var i=o.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],a=r[4],s=this.prev,l=r[1],c=r[2];if(-1===r[0])return n("end"),!1;if(!l&&!c)throw Error("try statement without catch or finally");if(null!=r[0]&&r[0]<=s){if(s<l)return this.method="next",this.arg=e,n(l),!0;if(s<c)return n(c),!1}}},abrupt:function(e,t){for(var o=this.tryEntries.length-1;o>=0;--o){var n=this.tryEntries[o];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var i=n;break}}i&&("break"===e||"continue"===e)&&i[0]<=t&&t<=i[2]&&(i=null);var r=i?i[4]:{};return r.type=e,r.arg=t,i?(this.method="next",this.next=i[2],p):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o[2]===e)return this.complete(o[4],o[3]),k(o),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o[0]===e){var n=o[4];if("throw"===n.type){var i=n.arg;k(o)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,o,n){return this.delegate={i:T(t),r:o,n:n},"next"===this.method&&(this.arg=e),p}},t}function l(e,t,o,n,i,a,s){try{var l=e[a](s),c=l.value}catch(e){return void o(e)}l.done?t(c):r.resolve(c).then(n,i)}console.log("🚀 COMMANDS.JS LOADED - Email validation system initializing..."),console.log("📅 Load time:",(new Date).toISOString());var c,u="e80f5458c550f5b85ef56175b789468a",d="https://api.botatwork.com/trigger-task/b6f44edd-8140-4084-881e-2c11c403c082";try{"undefined"!=typeof window&&window.getSuggestedReply?(c=window.getSuggestedReply,console.log("✅ getSuggestedReply imported from window")):console.log("⚠️ getSuggestedReply not found on window, will define locally")}catch(e){console.error("❌ Error importing getSuggestedReply:",e)}c||(c=function(){var e,t=(e=s().mark((function e(t){var o,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("🔧 Using local getSuggestedReply implementation"),console.log("📤 API params:",t),e.prev=2,e.next=5,fetch(d,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(u)},body:JSON.stringify(t)});case 5:if((o=e.sent).ok){e.next=8;break}throw new Error("HTTP error! status: ".concat(o.status));case 8:return e.next=10,o.json();case 10:return n=e.sent,console.log("📥 API response:",n),e.abrupt("return",n.result||n.response||n.content||"Enhanced email content generated");case 15:throw e.prev=15,e.t0=e.catch(2),console.error("❌ Local API call failed:",e.t0),e.t0;case 19:case"end":return e.stop()}}),e,null,[[2,15]])})),function(){var t=this,o=arguments;return new r((function(n,i){var r=e.apply(t,o);function a(e){l(r,n,i,a,s,"next",e)}function s(e){l(r,n,i,a,s,"throw",e)}a(void 0)}))});return function(e){return t.apply(this,arguments)}}(),console.log("✅ Local getSuggestedReply implementation ready"));try{i.e(186).then(i.bind(i,17186)).then((function(e){c=e.getSuggestedReply}))}catch(e){console.log("Could not import getSuggestedReply, will use direct API calls")}var f={agenda:{keywords:["agenda","meeting agenda","topics to discuss","discussion points"],category:"Meeting Structure",suggestions:["agenda","meeting topics","discussion items"]},action:{keywords:["action item","action required","next steps","follow up","todo"],category:"Action Items",suggestions:["action items","next steps","follow-up required"]},timeline:{keywords:["deadline","due date","timeline","schedule","by when"],category:"Timeline",suggestions:["deadline","timeline","completion date"]},participants:{keywords:["attendees","participants","who should attend","invitees"],category:"Participants",suggestions:["attendees","participants","invitees"]},greeting:{keywords:["dear","hello","hi","good morning","good afternoon"],category:"Greeting",suggestions:["Dear","Hello","Hi"]},closing:{keywords:["regards","best regards","sincerely","thank you","thanks"],category:"Closing",suggestions:["Best regards","Thank you","Sincerely"]}},g={lastValidationTime:0,lastEmailBody:"",validationInProgress:!1};function p(e){if(console.log("🚀🚀🚀 EMAIL VALIDATION TRIGGERED - OnMessageSend event fired 🚀🚀🚀"),console.log("Event object:",e),console.log("📅 Timestamp:",(new Date).toISOString()),console.log("🔧 validateEmail function loaded and called"),console.log("🎯 Event type:",a(e)),console.log("🎯 Event completed function:",a(null==e?void 0:e.completed)),console.log("🚨 SHOWING ALERT TO CONFIRM VALIDATION IS CALLED"),window.lastValidationEvent=e,g.validationInProgress=!1,e){if(!Office.context||!Office.context.mailbox||!Office.context.mailbox.item)return console.error("❌ Office context not available"),void(e&&"function"==typeof e.completed&&e.completed({allowEvent:!0}));Office.context.mailbox.item.body.getAsync("text",(function(t){if(t.status===Office.AsyncResultStatus.Failed)return console.error("Failed to get email body:",t.error),void e.completed({allowEvent:!0});var o=t.value.toLowerCase();console.log("📧 Email body length:",o.length),console.log("📧 Email body preview:",o.substring(0,200)+"..."),g.lastEmailBody=o,g.lastValidationTime=Date.now();var n=[];Object.keys(f).forEach((function(e){var t=f[e];t.keywords.some((function(e){return o.includes(e.toLowerCase())}))||n.push({category:t.category,suggestions:t.suggestions,key:e})})),console.log("🔍 Missing keywords found:",n.length),n.length>0?(console.log("❌ Missing categories:",n.map((function(e){return e.category}))),console.log("🎯 SHOWING VALIDATION DIALOG FOR INCOMPLETE EMAIL"),g.validationInProgress=!0,function(e,t){var o=h();console.log("🔍 Opening validation dialog:",o),console.log("📊 Missing keywords data:",e),console.log("🎯 Event object available:",!!t),Office.context.ui.displayDialogAsync(o,{height:60,width:50,displayInIframe:!0},(function(o){if(o.status===Office.AsyncResultStatus.Failed)return console.error("❌ Failed to open dialog:",o.error),void t.completed({allowEvent:!0});console.log("✅ Dialog opened successfully");var n=o.value;setTimeout((function(){console.log("📤 Sending data to dialog:",e),n.messageChild(JSON.stringify({type:"missing-keywords",data:e}))}),1e3),n.addEventHandler(Office.EventType.DialogMessageReceived,(function(e){console.log("📥 Dialog response received:",e.message);var o=JSON.parse(e.message);if(g.validationInProgress=!1,"send"===o.action){if(console.log("✅ User chose to send anyway - ALLOWING SEND"),t&&"function"==typeof t.completed)try{t.completed({allowEvent:!0}),console.log("✅ event.completed({ allowEvent: true }) called successfully")}catch(e){console.error("❌ Error calling event.completed for send:",e)}}else if("add-keywords"===o.action)console.log("🔧 User wants to add keywords:",o.keywords),function(e,t){console.log("🔧 ADD KEYWORDS TO EMAIL TRIGGERED"),console.log("📝 Selected keywords:",e),console.log("🎯 Event object available:",!!t);var o=Office.context.mailbox.item;o.body.getAsync("text",(function(n){if(n.status===Office.AsyncResultStatus.Failed)return console.error("Failed to get email body for keyword addition:",n.error),void(t&&"function"==typeof t.completed&&t.completed({allowEvent:!1}));var i=n.value;console.log("📧 Current email body:",i.substring(0,200)+"...");var r=o.conversationId&&o.conversationId.length>0;console.log("📨 Is reply:",r);var s=e.join(", "),l="";try{l=o.subject||""}catch(e){console.log("Could not get email subject:",e)}var u="Please rewrite this email to include these missing elements: ".concat(s,'. \n\nIMPORTANT CONTEXT:\n- Email Subject: "').concat(l,'"\n- Original email content: "').concat(i,'"\n\nPlease create a complete, professional email that:\n1. Maintains the ORIGINAL INTENT and context (sick leave, meeting, etc.)\n2. Includes the missing elements: ').concat(s,'\n3. Is appropriate for the subject matter\n4. Has a proper greeting and closing\n5. Is professional but matches the original tone\n\nDO NOT generate a generic meeting template. Instead, enhance the original email while keeping its specific purpose and context.\n\nOriginal email: "').concat(i,'"\nSubject: "').concat(l,'"\n\nPlease rewrite this as a complete, professional email that maintains the original intent.');console.log("🤖 Enhancement prompt:",u.substring(0,300)+"...");var d={chooseATask:"emailResponse",emailContent:u,tone:"professional",pointOfView:"organizationPerspective",additionalInstructions:"Focus on incorporating missing keywords naturally while maintaining the original message intent",anonymize:null,incognito:!1,default_language:"en-US",should_stream:!1};if(console.log("🚀 Calling BotAtWork API for email enhancement..."),console.log("📧 Email subject:",l),console.log("📝 Original content:",i),"function"==typeof c){console.log("✅ getSuggestedReply function available");var f=u;(l.toLowerCase().includes("sick")||l.toLowerCase().includes("leave")||i.toLowerCase().includes("sick")||i.toLowerCase().includes("leave"))&&(f="Please rewrite this SICK LEAVE email to include these missing elements: ".concat(s,'. \n\nIMPORTANT: This is a SICK LEAVE email, not a meeting email.\n\nOriginal email: "').concat(i,'"\nSubject: "').concat(l,'"\n\nPlease create a professional sick leave email that:\n1. Maintains the sick leave context\n2. Includes proper greeting and closing\n3. Clearly states the sick leave request\n4. Includes relevant details (dates, reason if appropriate, contact info)\n5. Is professional and respectful\n\nDO NOT generate a meeting template. This is about sick leave.'),console.log("🏥 Detected sick leave context, using specific prompt")),d.emailContent=f,c(d).then((function(e){if(console.log("🎉 Enhanced content received (full):",e),console.log("🔍 Content type:",a(e)),console.log("🔍 Content length:",e?e.length:"null"),console.log("🔍 Starts with API error?",e?e.startsWith("API error:"):"null"),console.log("🔍 Starts with Error calling?",e?e.startsWith("Error calling BotAtWork API:"):"null"),!e||e.startsWith("API error:")||e.startsWith("Error calling BotAtWork API:")){var n=e||"Unknown error occurred";console.error("❌ Enhancement failed - content rejected:",n),console.error("❌ Content was treated as error because it starts with error prefix"),t&&"function"==typeof t.completed&&t.completed({allowEvent:!1})}else console.log("📝 ATTEMPTING TO UPDATE EMAIL BODY..."),console.log("📧 Item object available:",!!o),console.log("📧 Item.body available:",!!o.body),console.log("📧 Item.body.setAsync available:",!(!o.body||!o.body.setAsync)),o.body.setAsync(e,{coercionType:Office.CoercionType.Text},(function(o){console.log("📝 setAsync callback called"),console.log("📝 setResult status:",o.status),console.log("📝 Expected success status:",Office.AsyncResultStatus.Succeeded),o.status===Office.AsyncResultStatus.Succeeded?(console.log("✅ EMAIL BODY UPDATED SUCCESSFULLY!"),console.log("🎯 Enhanced content was:",e.substring(0,300)+"..."),t&&"function"==typeof t.completed&&t.completed({allowEvent:!1})):(console.error("❌ FAILED TO UPDATE EMAIL BODY"),console.error("❌ Error details:",o.error),t&&"function"==typeof t.completed&&t.completed({allowEvent:!1}))}))})).catch((function(e){console.error("❌ Error calling BotAtWork API:",e),t&&"function"==typeof t.completed&&t.completed({allowEvent:!1})}))}else{var g;console.error("❌ getSuggestedReply function not available - using fallback"),l.toLowerCase().includes("sick")||l.toLowerCase().includes("leave")||i.toLowerCase().includes("sick")||i.toLowerCase().includes("leave")?(g="Dear [Manager's Name],\n\nI hope this email finds you well.\n\nI am writing to formally request sick leave.\n\n".concat(i,"\n\nI will ensure that any urgent matters are addressed before my leave, and I will coordinate with my team to minimize any disruption.\n\nPlease let me know if you need any additional information or documentation.\n\nThank you for your understanding.\n\nBest regards,\n[Your Name]"),console.log("🏥 Using sick leave fallback enhancement")):(g="Dear Team,\n\nI hope this email finds you well.\n\n".concat(i,"\n\nPlease let me know if you have any questions or need additional information.\n\nThank you for your time and consideration.\n\nBest regards,\n[Your Name]"),console.log("📧 Using general fallback enhancement")),console.log("🔄 ATTEMPTING FALLBACK EMAIL UPDATE..."),console.log("📝 Fallback content:",g.substring(0,200)+"..."),o.body.setAsync(g,{coercionType:Office.CoercionType.Text},(function(e){console.log("📝 Fallback setAsync callback called"),e.status===Office.AsyncResultStatus.Succeeded?(console.log("✅ EMAIL ENHANCED WITH FALLBACK CONTENT!"),t&&"function"==typeof t.completed&&t.completed({allowEvent:!1})):(console.error("❌ FAILED TO UPDATE EMAIL BODY WITH FALLBACK"),console.error("❌ Fallback error details:",e.error),t&&"function"==typeof t.completed&&t.completed({allowEvent:!1}))}))}}))}(o.keywords,t);else if("cancel"===o.action){if(console.log("❌ User cancelled - BLOCKING SEND"),console.log("🚫 Event completion with allowEvent: false"),console.log("🎯 About to call event.completed({ allowEvent: false })"),t&&"function"==typeof t.completed)try{t.completed({allowEvent:!1}),console.log("✅ event.completed({ allowEvent: false }) called successfully")}catch(e){console.error("❌ Error calling event.completed:",e)}}else if(console.log("❓ Unknown action:",o.action,"- BLOCKING SEND"),console.log("🚫 Event completion with allowEvent: false for unknown action"),t&&"function"==typeof t.completed)try{t.completed({allowEvent:!1}),console.log("✅ event.completed({ allowEvent: false }) called successfully for unknown action")}catch(e){console.error("❌ Error calling event.completed for unknown action:",e)}console.log("🔒 Closing dialog"),n.close()})),n.addEventHandler(Office.EventType.DialogEventReceived,(function(e){console.error("❌ Dialog error:",e.error),g.validationInProgress=!1,t.completed({allowEvent:!0})}))}))}(n,e)):(console.log("✅ All keywords present, allowing send"),e&&"function"==typeof e.completed&&e.completed({allowEvent:!0})),setTimeout((function(){console.log("⏰ Validation timeout fallback - ensuring event completion"),e&&"function"==typeof e.completed&&!g.validationInProgress&&e.completed({allowEvent:!0})}),3e4)}))}else console.error("❌ No event object provided to validateEmail")}function m(e,t,o,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},r=t.join(", "),a=o?"reply":"new email",s="Please enhance this ".concat(a," by naturally incorporating these missing elements: ").concat(r,"\n\nOriginal content:\n").concat(e,"\n\nInstructions:\n- Keep the original tone and intent\n- Naturally integrate the missing elements\n- Make it professional and coherent\n- Don't change the core message, just enhance it with the missing elements\n\nEnhanced ").concat(a,":"),l=i.chooseATask,f=void 0===l?"emailResponse":l,g=i.description,p=void 0===g?s:g,m=(i.emailContent,i.additionalInstructions),h=void 0===m?"":m,v=i.tone,y=void 0===v?"professional":v,w=i.pointOfView,b=void 0===w?"organizationPerspective":w,E=i.anonymize,A=void 0===E?null:E,O=i.incognito,I=void 0!==O&&O,x=i.default_language,k=void 0===x?"en-US":x,S=i.should_stream,T={data:{payload:{chooseATask:f,description:p,additionalInstructions:h,tone:y,pointOfView:b}},anonymize:A,incognito:I,default_language:k,should_stream:void 0!==S&&S};void 0!==c?(console.log("Using getSuggestedReply with apiParams:",i),c(p,3,i).then((function(e){n(e)})).catch((function(e){console.error("Failed to generate enhanced email:",e);var t=e.toString();n(t.startsWith("API error:")||t.startsWith("Error calling BotAtWork API:")?t:"Failed to generate enhanced email: ".concat(t))}))):(console.error("getSuggestedReply function not available - falling back to direct API call"),console.log("BotAtWork API Request Body:",JSON.stringify(T,null,2)),fetch(d,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":u},body:JSON.stringify(T)}).then((function(e){return e.json()})).then((function(e){console.log("BotAtWork API Response:",e),e&&"SUCCESS"===e.status&&e.data&&e.data.content?n(e.data.content):e&&e.response?n(e.response):(console.error("Invalid response from BotAtWork API:",e),n("API error: Invalid response format from BotAtWork API"))})).catch((function(e){console.error("Failed to generate enhanced email:",e);var t=e.toString();n(t.startsWith("API error:")||t.startsWith("Error calling BotAtWork API:")?t:"Failed to generate enhanced email: ".concat(t))})))}function h(){var e="localhost"===window.location.hostname,t=e?"https://localhost:3000":"https://nayaksubhasish.github.io/MAIL-MAGIC",o="".concat(t,"/validation-dialog.html");return console.log("🔗 Dialog URL:",o),console.log("🌐 Current hostname:",window.location.hostname),console.log("🔧 Is localhost:",e),console.log("📡 Base URL:",t),o}function v(e){var t,o={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"Performed action.",icon:"Icon.80x80",persistent:!0};null===(t=Office.context.mailbox.item)||void 0===t||t.notificationMessages.replaceAsync("ActionPerformanceNotification",o),e.completed()}function y(e){if(Office.context&&Office.context.mailbox&&Office.context.mailbox.item){var t,o={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"✅ Email validation completed. Sending email...",icon:"Icon.80x80",persistent:!1};null===(t=Office.context.mailbox.item)||void 0===t||t.notificationMessages.replaceAsync("ValidationNotification",o),Office.context.mailbox.item.saveAsync((function(e){if(e.status===Office.AsyncResultStatus.Succeeded){var t,o={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"✅ Email ready to send! Please click the Send button in Outlook.",icon:"Icon.80x80",persistent:!0};null===(t=Office.context.mailbox.item)||void 0===t||t.notificationMessages.replaceAsync("SendNotification",o)}}))}e.completed()}Office.onReady((function(){console.log("Office.js is ready - registering email validation"),window.validateEmail=p,console.log("validateEmail function registered globally")})),window.validateEmail=p,window.action=v,console.log("🔧 Registering Office.actions functions..."),Office.actions.associate("action",v),console.log("✅ action function registered"),Office.actions.associate("validateEmail",p),console.log("✅ validateEmail function registered"),Office.actions.associate("validateEmailManual",(function(e){if(console.log("Manual email validation triggered"),!Office.context||!Office.context.mailbox||!Office.context.mailbox.item)return console.error("Office context not available"),void e.completed();Office.context.mailbox.item.body.getAsync("text",(function(t){if(t.status===Office.AsyncResultStatus.Failed)return console.error("Failed to get email body:",t.error),void e.completed();var o=t.value.toLowerCase(),n=[];if(Object.keys(f).forEach((function(e){var t=f[e];t.keywords.some((function(e){return o.includes(e.toLowerCase())}))||n.push({category:t.category,suggestions:t.suggestions,key:e})})),n.length>0)!function(e,t){var o=h();Office.context.ui.displayDialogAsync(o,{height:60,width:50,displayInIframe:!0},(function(o){if(o.status===Office.AsyncResultStatus.Failed)return console.error("Failed to open dialog:",o.error),void t.completed();var n=o.value;setTimeout((function(){n.messageChild(JSON.stringify({type:"missing-keywords",data:e}))}),1e3),n.addEventHandler(Office.EventType.DialogMessageReceived,(function(e){var o=JSON.parse(e.message);if("send"===o.action){var i,r={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"Email validation completed. You can proceed with sending.",icon:"Icon.80x80",persistent:!0};null===(i=Office.context.mailbox.item)||void 0===i||i.notificationMessages.replaceAsync("ValidationNotification",r),t.completed()}else"add-keywords"===o.action?function(e,t){var o=Office.context.mailbox.item;o.body.getAsync("text",(function(n){if(n.status===Office.AsyncResultStatus.Failed)return console.error("Failed to get email body for keyword addition:",n.error),void t.completed();var i=n.value,r=o.conversationId&&o.conversationId.length>0;m(i,e,r,(function(e){if(!e||e.startsWith("API error:")||e.startsWith("Failed to generate enhanced email:")||e.startsWith("Error calling BotAtWork API:")){var n,i=e||"Unknown error occurred";console.error("Enhancement failed:",i);var r={type:Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,message:i.startsWith("API error:")||i.startsWith("Error calling BotAtWork API:")?i:"Failed to enhance email: ".concat(i),icon:"Icon.80x80",persistent:!0};null===(n=Office.context.mailbox.item)||void 0===n||n.notificationMessages.replaceAsync("ValidationNotification",r),t.completed()}else o.body.setAsync(e,{coercionType:Office.CoercionType.Text},(function(e){if(e.status===Office.AsyncResultStatus.Succeeded){var o;console.log("Email enhanced with keywords");var n={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"✅ Email enhanced with selected keywords!",icon:"Icon.80x80",persistent:!0};null===(o=Office.context.mailbox.item)||void 0===o||o.notificationMessages.replaceAsync("ValidationNotification",n),t.completed()}else console.error("Failed to update email body:",e.error),t.completed()}))}),{chooseATask:"emailWrite",tone:"professional",pointOfView:"organizationPerspective",additionalInstructions:"Enhance the email by naturally incorporating the missing keywords while preserving the original tone and message",anonymize:null,incognito:!1,default_language:"en-US",should_stream:!1})}))}(o.keywords,t):t.completed();n.close()})),n.addEventHandler(Office.EventType.DialogEventReceived,(function(e){console.error("Dialog error:",e.error),t.completed()}))}))}(n,e);else{var i,r={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"✅ Email validation passed! All important elements are present.",icon:"Icon.80x80",persistent:!0};null===(i=Office.context.mailbox.item)||void 0===i||i.notificationMessages.replaceAsync("ValidationNotification",r),e.completed()}}))})),console.log("✅ validateEmailManual function registered"),Office.actions.associate("sendWithValidation",(function(e){if(console.log("Send with validation triggered"),!Office.context||!Office.context.mailbox||!Office.context.mailbox.item)return console.error("Office context not available"),void e.completed();Office.context.mailbox.item.body.getAsync("text",(function(t){if(t.status===Office.AsyncResultStatus.Failed)return console.error("Failed to get email body:",t.error),void e.completed();var o=t.value.toLowerCase(),n=[];Object.keys(f).forEach((function(e){var t=f[e];t.keywords.some((function(e){return o.includes(e.toLowerCase())}))||n.push({category:t.category,suggestions:t.suggestions,key:e})})),n.length>0?function(e,t){var o=h();Office.context.ui.displayDialogAsync(o,{height:60,width:50,displayInIframe:!0},(function(o){if(o.status===Office.AsyncResultStatus.Failed)return console.error("Failed to open dialog:",o.error),void t.completed();var n=o.value;setTimeout((function(){n.messageChild(JSON.stringify({type:"missing-keywords",data:e,mode:"send"}))}),1e3),n.addEventHandler(Office.EventType.DialogMessageReceived,(function(e){var o=JSON.parse(e.message);"send"===o.action?y(t):"add-keywords"===o.action?function(e,t){var o=Office.context.mailbox.item;o.body.getAsync("text",(function(n){if(n.status===Office.AsyncResultStatus.Failed)return console.error("Failed to get email body for keyword addition:",n.error),void t.completed();var i=n.value,r=o.conversationId&&o.conversationId.length>0;m(i,e,r,(function(e){if(!e||e.startsWith("API error:")||e.startsWith("Failed to generate enhanced email:")||e.startsWith("Error calling BotAtWork API:")){var n,i=e||"Unknown error occurred";console.error("Enhancement failed:",i);var r={type:Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,message:i.startsWith("API error:")||i.startsWith("Error calling BotAtWork API:")?"".concat(i," Send anyway?"):"Failed to enhance email: ".concat(i,". Send anyway?"),icon:"Icon.80x80",persistent:!0};null===(n=Office.context.mailbox.item)||void 0===n||n.notificationMessages.replaceAsync("ValidationNotification",r),t.completed()}else o.body.setAsync(e,{coercionType:Office.CoercionType.Text},(function(e){e.status===Office.AsyncResultStatus.Succeeded?(console.log("Email enhanced with keywords, now sending..."),y(t)):(console.error("Failed to update email body:",e.error),t.completed())}))}),{chooseATask:"emailWrite",tone:"professional",pointOfView:"organizationPerspective",additionalInstructions:"Quickly enhance the email with missing keywords and prepare it for sending while maintaining professional tone",anonymize:null,incognito:!1,default_language:"en-US",should_stream:!1})}))}(o.keywords,t):t.completed(),n.close()})),n.addEventHandler(Office.EventType.DialogEventReceived,(function(e){console.error("Dialog error:",e.error),t.completed()}))}))}(n,e):y(e)}))})),console.log("✅ sendWithValidation function registered"),console.log("🔧 Attempting alternative ItemSend registration...");try{Office.context&&Office.context.mailbox&&console.log("✅ Office context available for alternative registration")}catch(e){console.error("❌ Error in alternative registration:",e)}window.testValidation=function(){console.log("🧪 Testing validation manually"),p({completed:function(e){console.log("✅ Test validation completed:",e)}})},window.resetValidationState=function(){console.log("🔄 Resetting validation state"),g={lastValidationTime:0,lastEmailBody:"",validationInProgress:!1},console.log("✅ Validation state reset:",g)},window.checkValidationState=function(){return console.log("📊 Current validation state:",g),g},window.checkValidationRegistration=function(){var e,t;console.log("🔍 Checking validation registration..."),console.log("✅ validateEmail function exists:",!0),console.log("✅ Office context available:",!!Office.context),console.log("✅ Mailbox available:",!(null===(e=Office.context)||void 0===e||!e.mailbox)),console.log("✅ Current validation state:",g),console.log("🎯 Last validation event:",window.lastValidationEvent),null!==(t=Office.context)&&void 0!==t&&null!==(t=t.mailbox)&&void 0!==t&&t.item?(console.log("✅ Email item accessible"),Office.context.mailbox.item.body.getAsync("text",(function(e){e.status===Office.AsyncResultStatus.Succeeded?console.log("✅ Email body accessible, length:",e.value.length):console.log("❌ Email body not accessible:",e.error)}))):console.log("❌ Email item not accessible")},window.testEventCompletion=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(console.log("🧪 Testing event completion with allowEvent:",e),window.lastValidationEvent){console.log("🎯 Using last validation event");try{window.lastValidationEvent.completed({allowEvent:e}),console.log("✅ Manual event.completed called successfully")}catch(e){console.error("❌ Error in manual event.completed:",e)}}else console.log("❌ No validation event available for testing")}}();
//# sourceMappingURL=commands.js.map