/*! For license information please see commands.js.LICENSE.txt */
!function(){var e,t,o={64583:function(e,t,o){e.exports=function(){"use strict";function e(e){return"function"==typeof e}var t=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},n=0,i=void 0,r=void 0,a=function(e,t){g[n]=e,g[n+1]=t,2===(n+=2)&&(r?r(p):w())};var l="undefined"!=typeof window?window:void 0,s=l||{},c=s.MutationObserver||s.WebKitMutationObserver,u="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),d="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function f(){var e=setTimeout;return function(){return e(p,1)}}var g=new Array(1e3);function p(){for(var e=0;e<n;e+=2)(0,g[e])(g[e+1]),g[e]=void 0,g[e+1]=void 0;n=0}var h,m,v,y,w=void 0;function b(e,t){var o=this,n=new this.constructor(O);void 0===n[A]&&R(n);var i=o._state;if(i){var r=arguments[i-1];a((function(){return D(i,n,r,o._result)}))}else N(o,n,e,t);return n}function E(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(O);return T(t,e),t}w=u?function(){return process.nextTick(p)}:c?(m=0,v=new c(p),y=document.createTextNode(""),v.observe(y,{characterData:!0}),function(){y.data=m=++m%2}):d?((h=new MessageChannel).port1.onmessage=p,function(){return h.port2.postMessage(0)}):void 0===l?function(){try{var e=Function("return this")().require("vertx");return void 0!==(i=e.runOnLoop||e.runOnContext)?function(){i(p)}:f()}catch(e){return f()}}():f();var A=Math.random().toString(36).substring(2);function O(){}var x=void 0,I=1,S=2;function k(t,o,n){o.constructor===t.constructor&&n===b&&o.constructor.resolve===E?function(e,t){t._state===I?P(e,t._result):t._state===S?M(e,t._result):N(t,void 0,(function(t){return T(e,t)}),(function(t){return M(e,t)}))}(t,o):void 0===n?P(t,o):e(n)?function(e,t,o){a((function(e){var n=!1,i=function(e,t,o,n){try{e.call(t,o,n)}catch(e){return e}}(o,t,(function(o){n||(n=!0,t!==o?T(e,o):P(e,o))}),(function(t){n||(n=!0,M(e,t))}),e._label);!n&&i&&(n=!0,M(e,i))}),e)}(t,o,n):P(t,o)}function T(e,t){if(e===t)M(e,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof(n=t),null===n||"object"!==i&&"function"!==i)P(e,t);else{var o=void 0;try{o=t.then}catch(t){return void M(e,t)}k(e,t,o)}var n,i}function _(e){e._onerror&&e._onerror(e._result),C(e)}function P(e,t){e._state===x&&(e._result=t,e._state=I,0!==e._subscribers.length&&a(C,e))}function M(e,t){e._state===x&&(e._state=S,e._result=t,a(_,e))}function N(e,t,o,n){var i=e._subscribers,r=i.length;e._onerror=null,i[r]=t,i[r+I]=o,i[r+S]=n,0===r&&e._state&&a(C,e)}function C(e){var t=e._subscribers,o=e._state;if(0!==t.length){for(var n=void 0,i=void 0,r=e._result,a=0;a<t.length;a+=3)n=t[a],i=t[a+o],n?D(o,n,i,r):i(r);e._subscribers.length=0}}function D(t,o,n,i){var r=e(n),a=void 0,l=void 0,s=!0;if(r){try{a=n(i)}catch(e){s=!1,l=e}if(o===a)return void M(o,new TypeError("A promises callback cannot return that same promise."))}else a=i;o._state!==x||(r&&s?T(o,a):!1===s?M(o,l):t===I?P(o,a):t===S&&M(o,a))}var j=0;function R(e){e[A]=j++,e._state=void 0,e._result=void 0,e._subscribers=[]}var L=function(){function e(e,o){this._instanceConstructor=e,this.promise=new e(O),this.promise[A]||R(this.promise),t(o)?(this.length=o.length,this._remaining=o.length,this._result=new Array(this.length),0===this.length?P(this.promise,this._result):(this.length=this.length||0,this._enumerate(o),0===this._remaining&&P(this.promise,this._result))):M(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===x&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var o=this._instanceConstructor,n=o.resolve;if(n===E){var i=void 0,r=void 0,a=!1;try{i=e.then}catch(e){a=!0,r=e}if(i===b&&e._state!==x)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(o===F){var l=new o(O);a?M(l,r):k(l,e,i),this._willSettleAt(l,t)}else this._willSettleAt(new o((function(t){return t(e)})),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,o){var n=this.promise;n._state===x&&(this._remaining--,e===S?M(n,o):this._result[t]=o),0===this._remaining&&P(n,this._result)},e.prototype._willSettleAt=function(e,t){var o=this;N(e,void 0,(function(e){return o._settledAt(I,t,e)}),(function(e){return o._settledAt(S,t,e)}))},e}();var F=function(){function t(e){this[A]=j++,this._result=this._state=void 0,this._subscribers=[],O!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){T(e,t)}),(function(t){M(e,t)}))}catch(t){M(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var o=this,n=o.constructor;return e(t)?o.then((function(e){return n.resolve(t()).then((function(){return e}))}),(function(e){return n.resolve(t()).then((function(){throw e}))})):o.then(t,t)},t}();return F.prototype.then=b,F.all=function(e){return new L(this,e).promise},F.race=function(e){var o=this;return t(e)?new o((function(t,n){for(var i=e.length,r=0;r<i;r++)o.resolve(e[r]).then(t,n)})):new o((function(e,t){return t(new TypeError("You must pass an array to race."))}))},F.resolve=E,F.reject=function(e){var t=new this(O);return M(t,e),t},F._setScheduler=function(e){r=e},F._setAsap=function(e){a=e},F._asap=a,F.polyfill=function(){var e=void 0;if(void 0!==o.g)e=o.g;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=F},F.Promise=F,F}()}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var r=n[e]={exports:{}};return o[e].call(r.exports,r,r.exports,i),r.exports}i.m=o,i.d=function(e,t){for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.f={},i.e=function(e){return r.all(Object.keys(i.f).reduce((function(t,o){return i.f[o](e,t),t}),[]))},i.u=function(e){return e+".js"},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e={},t="outlook-plugin:",i.l=function(o,n,r,a){if(e[o])e[o].push(n);else{var l,s;if(void 0!==r)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==o||d.getAttribute("data-webpack")==t+r){l=d;break}}l||(s=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,i.nc&&l.setAttribute("nonce",i.nc),l.setAttribute("data-webpack",t+r),l.src=o),e[o]=[n];var f=function(t,n){l.onerror=l.onload=null,clearTimeout(g);var i=e[o];if(delete e[o],l.parentNode&&l.parentNode.removeChild(l),i&&i.forEach((function(e){return e(n)})),t)return t(n)},g=setTimeout(f.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=f.bind(null,l.onerror),l.onload=f.bind(null,l.onload),s&&document.head.appendChild(l)}},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");if(o.length)for(var n=o.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=o[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e}(),function(){var e={217:0};i.f.j=function(t,o){var n=i.o(e,t)?e[t]:void 0;if(0!==n)if(n)o.push(n[2]);else{var a=new r((function(o,i){n=e[t]=[o,i]}));o.push(n[2]=a);var l=i.p+i.u(t),s=new Error;i.l(l,(function(o){if(i.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var r=o&&("load"===o.type?"missing":o.type),a=o&&o.target&&o.target.src;s.message="Loading chunk "+t+" failed.\n("+r+": "+a+")",s.name="ChunkLoadError",s.type=r,s.request=a,n[1](s)}}),"chunk-"+t,t)}};var t=function(t,o){var n,r,a=o[0],l=o[1],s=o[2],c=0;if(a.some((function(t){return 0!==e[t]}))){for(n in l)i.o(l,n)&&(i.m[n]=l[n]);s&&s(i)}for(t&&t(o);c<a.length;c++)r=a[c],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0},o=self.webpackChunkoutlook_plugin=self.webpackChunkoutlook_plugin||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var r=i(64583).Promise;function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function l(){"use strict";l=function(){return t};var e,t={},o=Object.prototype,n=o.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function d(e,t,o,n){return Object.defineProperty(e,t,{value:o,enumerable:!n,configurable:!n,writable:!n})}try{d({},"")}catch(e){d=function(e,t,o){return e[t]=o}}function f(t,o,n,i){var r=o&&o.prototype instanceof h?o:h,a=Object.create(r.prototype);return d(a,"_invoke",function(t,o,n){var i=1;return function(r,a){if(3===i)throw Error("Generator is already running");if(4===i){if("throw"===r)throw a;return{value:e,done:!0}}for(n.method=r,n.arg=a;;){var l=n.delegate;if(l){var s=x(l,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===i)throw i=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=3;var c=g(t,o,n);if("normal"===c.type){if(i=n.done?4:2,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=4,n.method="throw",n.arg=c.arg)}}}(t,n,new k(i||[])),!0),a}function g(e,t,o){try{return{type:"normal",arg:e.call(t,o)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var p={};function h(){}function m(){}function v(){}var y={};d(y,s,(function(){return this}));var w=Object.getPrototypeOf,b=w&&w(w(T([])));b&&b!==o&&n.call(b,s)&&(y=b);var E=v.prototype=h.prototype=Object.create(y);function A(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function o(i,r,l,s){var c=g(e[i],e,r);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==a(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){o("next",e,l,s)}),(function(e){o("throw",e,l,s)})):t.resolve(d).then((function(e){u.value=e,l(u)}),(function(e){return o("throw",e,l,s)}))}s(c.arg)}var i;d(this,"_invoke",(function(e,n){function r(){return new t((function(t,i){o(e,n,t,i)}))}return i=i?i.then(r,r):r()}),!0)}function x(t,o){var n=o.method,i=t.i[n];if(i===e)return o.delegate=null,"throw"===n&&t.i.return&&(o.method="return",o.arg=e,x(t,o),"throw"===o.method)||"return"!==n&&(o.method="throw",o.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var r=g(i,t.i,o.arg);if("throw"===r.type)return o.method="throw",o.arg=r.arg,o.delegate=null,p;var a=r.arg;return a?a.done?(o[t.r]=a.value,o.next=t.n,"return"!==o.method&&(o.method="next",o.arg=e),o.delegate=null,p):a:(o.method="throw",o.arg=new TypeError("iterator result is not an object"),o.delegate=null,p)}function I(e){this.tryEntries.push(e)}function S(t){var o=t[4]||{};o.type="normal",o.arg=e,t[4]=o}function k(e){this.tryEntries=[[-1]],e.forEach(I,this),this.reset(!0)}function T(t){if(null!=t){var o=t[s];if(o)return o.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function o(){for(;++i<t.length;)if(n.call(t,i))return o.value=t[i],o.done=!1,o;return o.value=e,o.done=!0,o};return r.next=r}}throw new TypeError(a(t)+" is not iterable")}return m.prototype=v,d(E,"constructor",v),d(v,"constructor",m),m.displayName=d(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,d(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},A(O.prototype),d(O.prototype,c,(function(){return this})),t.AsyncIterator=O,t.async=function(e,o,n,i,a){void 0===a&&(a=r);var l=new O(f(e,o,n,i),a);return t.isGeneratorFunction(o)?l:l.next().then((function(e){return e.done?e.value:l.next()}))},A(E),d(E,u,"Generator"),d(E,s,(function(){return this})),d(E,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),o=[];for(var n in t)o.unshift(n);return function e(){for(;o.length;)if((n=o.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},t.values=T,k.prototype={constructor:k,reset:function(t){if(this.prev=this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(S),!t)for(var o in this)"t"===o.charAt(0)&&n.call(this,o)&&!isNaN(+o.slice(1))&&(this[o]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var o=this;function n(e){a.type="throw",a.arg=t,o.next=e}for(var i=o.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],a=r[4],l=this.prev,s=r[1],c=r[2];if(-1===r[0])return n("end"),!1;if(!s&&!c)throw Error("try statement without catch or finally");if(null!=r[0]&&r[0]<=l){if(l<s)return this.method="next",this.arg=e,n(s),!0;if(l<c)return n(c),!1}}},abrupt:function(e,t){for(var o=this.tryEntries.length-1;o>=0;--o){var n=this.tryEntries[o];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var i=n;break}}i&&("break"===e||"continue"===e)&&i[0]<=t&&t<=i[2]&&(i=null);var r=i?i[4]:{};return r.type=e,r.arg=t,i?(this.method="next",this.next=i[2],p):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o[2]===e)return this.complete(o[4],o[3]),S(o),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o[0]===e){var n=o[4];if("throw"===n.type){var i=n.arg;S(o)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,o,n){return this.delegate={i:T(t),r:o,n:n},"next"===this.method&&(this.arg=e),p}},t}function s(e,t,o,n,i,a,l){try{var s=e[a](l),c=s.value}catch(e){return void o(e)}s.done?t(c):r.resolve(c).then(n,i)}console.log("🚀 COMMANDS.JS LOADED - Email validation system initializing..."),console.log("📅 Load time:",(new Date).toISOString());var c,u="e80f5458c550f5b85ef56175b789468a",d="https://api.botatwork.com/trigger-task/b6f44edd-8140-4084-881e-2c11c403c082";try{"undefined"!=typeof window&&window.getSuggestedReply?(c=window.getSuggestedReply,console.log("✅ getSuggestedReply imported from window")):console.log("⚠️ getSuggestedReply not found on window, will define locally")}catch(e){console.error("❌ Error importing getSuggestedReply:",e)}c||(c=function(){var e,t=(e=l().mark((function e(t){var o,n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("🔧 Using local getSuggestedReply implementation"),console.log("📤 API params:",t),e.prev=2,e.next=5,fetch(d,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(u)},body:JSON.stringify(t)});case 5:if((o=e.sent).ok){e.next=8;break}throw new Error("HTTP error! status: ".concat(o.status));case 8:return e.next=10,o.json();case 10:return n=e.sent,console.log("📥 API response:",n),e.abrupt("return",n.result||n.response||n.content||"Enhanced email content generated");case 15:throw e.prev=15,e.t0=e.catch(2),console.error("❌ Local API call failed:",e.t0),e.t0;case 19:case"end":return e.stop()}}),e,null,[[2,15]])})),function(){var t=this,o=arguments;return new r((function(n,i){var r=e.apply(t,o);function a(e){s(r,n,i,a,l,"next",e)}function l(e){s(r,n,i,a,l,"throw",e)}a(void 0)}))});return function(e){return t.apply(this,arguments)}}(),console.log("✅ Local getSuggestedReply implementation ready"));try{i.e(186).then(i.bind(i,17186)).then((function(e){c=e.getSuggestedReply}))}catch(e){console.log("Could not import getSuggestedReply, will use direct API calls")}var f={agenda:{keywords:["agenda","meeting agenda","topics to discuss","discussion points"],category:"Meeting Structure",suggestions:["agenda","meeting topics","discussion items"]},action:{keywords:["action item","action required","next steps","follow up","todo"],category:"Action Items",suggestions:["action items","next steps","follow-up required"]},timeline:{keywords:["deadline","due date","timeline","schedule","by when"],category:"Timeline",suggestions:["deadline","timeline","completion date"]},participants:{keywords:["attendees","participants","who should attend","invitees"],category:"Participants",suggestions:["attendees","participants","invitees"]},greeting:{keywords:["dear","hello","hi","good morning","good afternoon"],category:"Greeting",suggestions:["Dear","Hello","Hi"]},closing:{keywords:["regards","best regards","sincerely","thank you","thanks"],category:"Closing",suggestions:["Best regards","Thank you","Sincerely"]}},g={lastValidationTime:0,lastEmailBody:"",validationInProgress:!1};function p(e){if(!e||"string"!=typeof e)return e||"";var t=e;return(t=t.replace(/^([^\n]*\|[^\n]*\n)([^\n]*\|[^\n]*\n)([^\n]*\|[^\n]*\n)+/gm,(function(e){var t=e.trim().split("\n");if(t.length<3)return e;var o=t[0],n=t[1],i=t.slice(2);if(!/^\s*\|?\s*:?[-|:\s]+\s*\|?\s*$/.test(n))return e;var r=o.split("|").map((function(e){return e.trim()})).filter(Boolean),a=i.map((function(e){return e.split("|").map((function(e){return e.trim()})).filter(Boolean)})),l='<table style="border-collapse: collapse; width: 100%; margin: 16px 0; border: 1px solid #d1d1d1;">';return r.length>0&&(l+="<thead><tr>",r.forEach((function(e){l+='<th style="border: 1px solid #d1d1d1; padding: 8px 12px; background-color: #f8f9fa; font-weight: 600; text-align: left;">'.concat(h(e),"</th>")})),l+="</tr></thead>"),a.length>0&&(l+="<tbody>",a.forEach((function(e){l+="<tr>",e.forEach((function(e){l+='<td style="border: 1px solid #d1d1d1; padding: 8px 12px; vertical-align: top;">'.concat(h(e),"</td>")}));for(var t=e.length;t<r.length;t++)l+='<td style="border: 1px solid #d1d1d1; padding: 8px 12px; vertical-align: top;"></td>';l+="</tr>"})),l+="</tbody>"),l+="</table>"}))).replace(/^[\s]*[-*][\s]+(.+)$/gm,"<li>$1</li>").replace(/^[\s]*\d+\.\s+(.+)$/gm,"<li>$1</li>").replace(/(<li>[^]*<\/li>)/g,"<ul>$1</ul>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/__(.*?)__/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/_(.*?)__/g,"<em>$1</em>").replace(/\n\n+/g,"</p><p>").replace(/\n/g,"<br/>").replace(/^([^]+)$/,"<p>$1</p>").replace(/<p><\/p>/g,"").replace(/<p><p>/g,"<p>").replace(/<\/p><\/p>/g,"</p>").replace(/<\/ul>\s*<ul>/g,"</ul><ul>").replace(/<\/p>\s*<ul>/g,"</p><ul>").replace(/<\/ul>\s*<p>/g,"</ul><p>")}function h(e){return e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}function m(e){if(console.log("🚀🚀🚀 EMAIL VALIDATION TRIGGERED - SEND BUTTON INTERCEPTED! 🚀🚀🚀"),console.log("🔥 SUCCESS: Send interception is working! 🔥"),console.log("Event object:",e),console.log("📅 Timestamp:",(new Date).toISOString()),console.log("🔧 validateEmail function loaded and called"),console.log("🎯 SHOWING VALIDATION DIALOG..."),console.log("🎯 Event type:",a(e)),console.log("🎯 Event completed function:",a(null==e?void 0:e.completed)),console.log("🚨 SHOWING ALERT TO CONFIRM VALIDATION IS CALLED"),window.lastValidationEvent=e,g.validationInProgress=!1,e){if(!Office.context||!Office.context.mailbox||!Office.context.mailbox.item)return console.error("❌ Office context not available"),void(e&&"function"==typeof e.completed&&e.completed({allowEvent:!0}));Office.context.mailbox.item.body.getAsync("text",(function(t){if(t.status===Office.AsyncResultStatus.Failed)return console.error("Failed to get email body:",t.error),void e.completed({allowEvent:!0});var o=t.value.toLowerCase();console.log("📧 Email body length:",o.length),console.log("📧 Email body preview:",o.substring(0,200)+"..."),g.lastEmailBody=o,g.lastValidationTime=Date.now();var n=[];Object.keys(f).forEach((function(e){var t=f[e];t.keywords.some((function(e){return o.includes(e.toLowerCase())}))||n.push({category:t.category,suggestions:t.suggestions,key:e})})),console.log("🔍 Missing keywords found:",n.length),n.length>0?(console.log("❌ Missing categories:",n.map((function(e){return e.category}))),console.log("🎯 SHOWING VALIDATION DIALOG FOR INCOMPLETE EMAIL"),g.validationInProgress=!0,function(e,t){var o=y();console.log("🔍 Opening validation dialog:",o),console.log("📊 Missing keywords data:",e),console.log("🎯 Event object available:",!!t),Office.context.ui.displayDialogAsync(o,{height:40,width:35,displayInIframe:!0},(function(o){if(o.status===Office.AsyncResultStatus.Failed)return console.error("❌ Failed to open dialog:",o.error),void t.completed({allowEvent:!0});console.log("✅ Dialog opened successfully");var n=o.value,i=0,r=function(){i++,console.log("📤 Sending data to dialog (attempt ".concat(i,"):"),e);try{n.messageChild(JSON.stringify({type:"missing-keywords",data:e}))}catch(e){console.error("❌ Error sending message to dialog:",e),i<5&&setTimeout(r,1e3)}};setTimeout(r,500),setTimeout(r,1500),setTimeout(r,3e3),n.addEventHandler(Office.EventType.DialogMessageReceived,(function(e){console.log("📥 Dialog response received:",e.message);var o=JSON.parse(e.message);if(g.validationInProgress=!1,"send"===o.action){if(console.log("✅ User chose to send anyway - ALLOWING SEND"),t&&"function"==typeof t.completed)try{t.completed({allowEvent:!0}),console.log("✅ event.completed({ allowEvent: true }) called successfully")}catch(e){console.error("❌ Error calling event.completed for send:",e)}}else if("add-keywords"===o.action)console.log("🔧 User wants to add keywords:",o.keywords),function(e,t){console.log("🔧 ADD KEYWORDS TO EMAIL TRIGGERED"),console.log("📝 Selected keywords:",e),console.log("🎯 Event object available:",!!t);var o=Office.context.mailbox.item;o.body.getAsync("text",(function(n){if(n.status===Office.AsyncResultStatus.Failed)return console.error("Failed to get email body for keyword addition:",n.error),void(t&&"function"==typeof t.completed&&t.completed({allowEvent:!1}));var i=n.value;console.log("📧 Current email body:",i.substring(0,200)+"...");var r=o.conversationId&&o.conversationId.length>0;console.log("📨 Is reply:",r);var l=e.join(", ");console.log("📧 Item object available:",!!o),console.log("📧 Getting subject asynchronously..."),o.subject.getAsync((function(e){var n="";e.status===Office.AsyncResultStatus.Succeeded?(n=e.value||"",console.log("📧 Subject retrieved successfully:",n)):(console.log("📧 Failed to get subject:",e.error),n="");var r="Please enhance this email by adding the missing keywords while maintaining the original context and intent.\n\nSubject: ".concat(n,"\n\nOriginal Email:\n").concat(i,"\n\nMissing Keywords to Include: ").concat(l,"\n\nPlease rewrite this email to include all the missing keywords naturally while preserving the original purpose and context from the subject and content.");console.log("🤖 Enhancement prompt created"),console.log("📧 Subject being passed:",n),console.log("📝 Body being passed:",i.substring(0,100)+"..."),console.log("🏷️ Keywords being passed:",l);var s={chooseATask:"emailResponse",emailContent:r,tone:"professional",pointOfView:"organizationPerspective",additionalInstructions:"Include these keywords: ".concat(l),anonymize:null,incognito:!1,default_language:"en-US",should_stream:!1};if(console.log("🚀 Calling BotAtWork API for email enhancement..."),console.log("📧 Email subject:",n),console.log("📝 Original content:",i),"function"==typeof c)console.log("✅ getSuggestedReply function available"),c(s).then((function(e){if(console.log("🎉 Enhanced content received (full):",e),console.log("🔍 Content type:",a(e)),console.log("🔍 Content length:",e?e.length:"null"),console.log("🔍 Starts with API error?",e?e.startsWith("API error:"):"null"),console.log("🔍 Starts with Error calling?",e?e.startsWith("Error calling BotAtWork API:"):"null"),!e||e.startsWith("API error:")||e.startsWith("Error calling BotAtWork API:")){var n=e||"Unknown error occurred";console.error("❌ Enhancement failed - content rejected:",n),console.error("❌ Content was treated as error because it starts with error prefix"),t&&"function"==typeof t.completed&&t.completed({allowEvent:!1})}else{console.log("📝 ATTEMPTING TO UPDATE EMAIL BODY..."),console.log("📧 Item object available:",!!o),console.log("📧 Item.body available:",!!o.body),console.log("📧 Item.body.setAsync available:",!(!o.body||!o.body.setAsync)),console.log("📧 Enhanced content:",e);var i=p(e);console.log("🔧 Converting markdown to HTML for Outlook..."),console.log("📝 Original content:",e.substring(0,200)+"..."),console.log("🔧 Formatted HTML:",i.substring(0,200)+"..."),o.body.setAsync(i,{coercionType:Office.CoercionType.Html},(function(o){console.log("📝 setAsync callback called"),console.log("📝 setResult status:",o.status),console.log("📝 Expected success status:",Office.AsyncResultStatus.Succeeded),o.status===Office.AsyncResultStatus.Succeeded?(console.log("✅ EMAIL BODY UPDATED SUCCESSFULLY!"),console.log("🎯 Enhanced content was:",e.substring(0,300)+"..."),t&&"function"==typeof t.completed&&t.completed({allowEvent:!1})):(console.error("❌ FAILED TO UPDATE EMAIL BODY"),console.error("❌ Error details:",o.error),t&&"function"==typeof t.completed&&t.completed({allowEvent:!1}))}))}})).catch((function(e){console.error("❌ Error calling BotAtWork API:",e),t&&"function"==typeof t.completed&&t.completed({allowEvent:!1})}));else{console.error("❌ getSuggestedReply function not available - using simple fallback");var u="Dear [Recipient],\n\n".concat(i,"\n\nMissing elements that should be added: ").concat(l,"\n\nBest regards,\n[Your Name]");console.log("🔄 ATTEMPTING FALLBACK EMAIL UPDATE..."),console.log("📝 Fallback content:",u.substring(0,200)+"...");var d=p(u);console.log("🔧 Converting fallback content to HTML..."),o.body.setAsync(d,{coercionType:Office.CoercionType.Html},(function(e){console.log("📝 Fallback setAsync callback called"),e.status===Office.AsyncResultStatus.Succeeded?(console.log("✅ EMAIL ENHANCED WITH FALLBACK CONTENT!"),t&&"function"==typeof t.completed&&t.completed({allowEvent:!1})):(console.error("❌ FAILED TO UPDATE EMAIL BODY WITH FALLBACK"),console.error("❌ Fallback error details:",e.error),t&&"function"==typeof t.completed&&t.completed({allowEvent:!1}))}))}}))}))}(o.keywords,t);else if("cancel"===o.action){if(console.log("❌ User cancelled - BLOCKING SEND"),console.log("🚫 Event completion with allowEvent: false"),console.log("🎯 About to call event.completed({ allowEvent: false })"),t&&"function"==typeof t.completed)try{t.completed({allowEvent:!1}),console.log("✅ event.completed({ allowEvent: false }) called successfully")}catch(e){console.error("❌ Error calling event.completed:",e)}}else if(console.log("❓ Unknown action:",o.action,"- BLOCKING SEND"),console.log("🚫 Event completion with allowEvent: false for unknown action"),t&&"function"==typeof t.completed)try{t.completed({allowEvent:!1}),console.log("✅ event.completed({ allowEvent: false }) called successfully for unknown action")}catch(e){console.error("❌ Error calling event.completed for unknown action:",e)}console.log("🔒 Closing dialog"),n.close()})),n.addEventHandler(Office.EventType.DialogEventReceived,(function(e){console.error("❌ Dialog error:",e.error),g.validationInProgress=!1,t.completed({allowEvent:!0})}))}))}(n,e)):(console.log("✅ All keywords present, allowing send"),e&&"function"==typeof e.completed&&e.completed({allowEvent:!0})),setTimeout((function(){console.log("⏰ Validation timeout fallback - ensuring event completion"),e&&"function"==typeof e.completed&&!g.validationInProgress&&e.completed({allowEvent:!0})}),3e4)}))}else console.error("❌ No event object provided to validateEmail")}function v(e,t,o,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},r=t.join(", "),a=o?"reply":"new email",l="Please enhance this ".concat(a," by naturally incorporating these missing elements: ").concat(r,"\n\nOriginal content:\n").concat(e,"\n\nInstructions:\n- Keep the original tone and intent\n- Naturally integrate the missing elements\n- Make it professional and coherent\n- Don't change the core message, just enhance it with the missing elements\n\nEnhanced ").concat(a,":"),s=i.chooseATask,f=void 0===s?"emailResponse":s,g=i.description,p=void 0===g?l:g,h=(i.emailContent,i.additionalInstructions),m=void 0===h?"":h,v=i.tone,y=void 0===v?"professional":v,w=i.pointOfView,b=void 0===w?"organizationPerspective":w,E=i.anonymize,A=void 0===E?null:E,O=i.incognito,x=void 0!==O&&O,I=i.default_language,S=void 0===I?"en-US":I,k=i.should_stream,T={data:{payload:{chooseATask:f,description:p,additionalInstructions:m,tone:y,pointOfView:b}},anonymize:A,incognito:x,default_language:S,should_stream:void 0!==k&&k};void 0!==c?(console.log("Using getSuggestedReply with apiParams:",i),c(p,3,i).then((function(e){n(e)})).catch((function(e){console.error("Failed to generate enhanced email:",e);var t=e.toString();n(t.startsWith("API error:")||t.startsWith("Error calling BotAtWork API:")?t:"Failed to generate enhanced email: ".concat(t))}))):(console.error("getSuggestedReply function not available - falling back to direct API call"),console.log("BotAtWork API Request Body:",JSON.stringify(T,null,2)),fetch(d,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":u},body:JSON.stringify(T)}).then((function(e){return e.json()})).then((function(e){console.log("BotAtWork API Response:",e),e&&"SUCCESS"===e.status&&e.data&&e.data.content?n(e.data.content):e&&e.response?n(e.response):(console.error("Invalid response from BotAtWork API:",e),n("API error: Invalid response format from BotAtWork API"))})).catch((function(e){console.error("Failed to generate enhanced email:",e);var t=e.toString();n(t.startsWith("API error:")||t.startsWith("Error calling BotAtWork API:")?t:"Failed to generate enhanced email: ".concat(t))})))}function y(){var e="localhost"===window.location.hostname,t=e?"https://localhost:3000/validation-dialog.html":"https://nayaksubhasish.github.io/MS-Plugin/validation-dialog.html";return console.log("🔗 Dialog URL:",t),console.log("🌐 Current hostname:",window.location.hostname),console.log("🔧 Is localhost:",e),t}function w(e){var t,o={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"Performed action.",icon:"Icon.80x80",persistent:!0};null===(t=Office.context.mailbox.item)||void 0===t||t.notificationMessages.replaceAsync("ActionPerformanceNotification",o),e.completed()}function b(e){if(Office.context&&Office.context.mailbox&&Office.context.mailbox.item){var t,o={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"✅ Email validation completed. Sending email...",icon:"Icon.80x80",persistent:!1};null===(t=Office.context.mailbox.item)||void 0===t||t.notificationMessages.replaceAsync("ValidationNotification",o),Office.context.mailbox.item.saveAsync((function(e){if(e.status===Office.AsyncResultStatus.Succeeded){var t,o={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"✅ Email ready to send! Please click the Send button in Outlook.",icon:"Icon.80x80",persistent:!0};null===(t=Office.context.mailbox.item)||void 0===t||t.notificationMessages.replaceAsync("SendNotification",o)}}))}e.completed()}Office.onReady((function(){console.log("Office.js is ready - registering email validation"),window.validateEmail=m,console.log("validateEmail function registered globally"),console.log("🔧 ItemSend event handler registration DISABLED")})),window.validateEmail=m,window.action=w,console.log("🔧 Registering Office.actions functions..."),Office.actions.associate("action",w),console.log("✅ action function registered"),Office.actions.associate("validateEmail",m),console.log("✅ validateEmail function registered"),Office.actions.associate("validateEmailManual",(function(e){if(console.log("Manual email validation triggered"),!Office.context||!Office.context.mailbox||!Office.context.mailbox.item)return console.error("Office context not available"),void e.completed();Office.context.mailbox.item.body.getAsync("text",(function(t){if(t.status===Office.AsyncResultStatus.Failed)return console.error("Failed to get email body:",t.error),void e.completed();var o=t.value.toLowerCase(),n=[];if(Object.keys(f).forEach((function(e){var t=f[e];t.keywords.some((function(e){return o.includes(e.toLowerCase())}))||n.push({category:t.category,suggestions:t.suggestions,key:e})})),n.length>0)!function(e,t){var o=y();Office.context.ui.displayDialogAsync(o,{height:40,width:35,displayInIframe:!0},(function(o){if(o.status===Office.AsyncResultStatus.Failed)return console.error("Failed to open dialog:",o.error),void t.completed();var n=o.value;setTimeout((function(){n.messageChild(JSON.stringify({type:"missing-keywords",data:e}))}),1e3),n.addEventHandler(Office.EventType.DialogMessageReceived,(function(e){var o=JSON.parse(e.message);if("send"===o.action){var i,r={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"Email validation completed. You can proceed with sending.",icon:"Icon.80x80",persistent:!0};null===(i=Office.context.mailbox.item)||void 0===i||i.notificationMessages.replaceAsync("ValidationNotification",r),t.completed()}else"add-keywords"===o.action?function(e,t){var o=Office.context.mailbox.item;o.body.getAsync("text",(function(n){if(n.status===Office.AsyncResultStatus.Failed)return console.error("Failed to get email body for keyword addition:",n.error),void t.completed();var i=n.value,r=o.conversationId&&o.conversationId.length>0;v(i,e,r,(function(e){if(!e||e.startsWith("API error:")||e.startsWith("Failed to generate enhanced email:")||e.startsWith("Error calling BotAtWork API:")){var n,i=e||"Unknown error occurred";console.error("Enhancement failed:",i);var r={type:Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,message:i.startsWith("API error:")||i.startsWith("Error calling BotAtWork API:")?i:"Failed to enhance email: ".concat(i),icon:"Icon.80x80",persistent:!0};null===(n=Office.context.mailbox.item)||void 0===n||n.notificationMessages.replaceAsync("ValidationNotification",r),t.completed()}else{var a=p(e);console.log("🔧 Converting markdown to HTML for manual validation..."),o.body.setAsync(a,{coercionType:Office.CoercionType.Html},(function(e){if(e.status===Office.AsyncResultStatus.Succeeded){var o;console.log("Email enhanced with keywords");var n={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"✅ Email enhanced with selected keywords!",icon:"Icon.80x80",persistent:!0};null===(o=Office.context.mailbox.item)||void 0===o||o.notificationMessages.replaceAsync("ValidationNotification",n),t.completed()}else console.error("Failed to update email body:",e.error),t.completed()}))}}),{chooseATask:"emailWrite",tone:"professional",pointOfView:"organizationPerspective",additionalInstructions:"Enhance the email by naturally incorporating the missing keywords while preserving the original tone and message",anonymize:null,incognito:!1,default_language:"en-US",should_stream:!1})}))}(o.keywords,t):t.completed();n.close()})),n.addEventHandler(Office.EventType.DialogEventReceived,(function(e){console.error("Dialog error:",e.error),t.completed()}))}))}(n,e);else{var i,r={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"✅ Email validation passed! All important elements are present.",icon:"Icon.80x80",persistent:!0};null===(i=Office.context.mailbox.item)||void 0===i||i.notificationMessages.replaceAsync("ValidationNotification",r),e.completed()}}))})),console.log("✅ validateEmailManual function registered"),Office.actions.associate("sendWithValidation",(function(e){if(console.log("Send with validation triggered"),!Office.context||!Office.context.mailbox||!Office.context.mailbox.item)return console.error("Office context not available"),void e.completed();Office.context.mailbox.item.body.getAsync("text",(function(t){if(t.status===Office.AsyncResultStatus.Failed)return console.error("Failed to get email body:",t.error),void e.completed();var o=t.value.toLowerCase(),n=[];Object.keys(f).forEach((function(e){var t=f[e];t.keywords.some((function(e){return o.includes(e.toLowerCase())}))||n.push({category:t.category,suggestions:t.suggestions,key:e})})),n.length>0?function(e,t){var o=y();Office.context.ui.displayDialogAsync(o,{height:40,width:35,displayInIframe:!0},(function(o){if(o.status===Office.AsyncResultStatus.Failed)return console.error("Failed to open dialog:",o.error),void t.completed();var n=o.value;setTimeout((function(){n.messageChild(JSON.stringify({type:"missing-keywords",data:e,mode:"send"}))}),1e3),n.addEventHandler(Office.EventType.DialogMessageReceived,(function(e){var o=JSON.parse(e.message);"send"===o.action?b(t):"add-keywords"===o.action?function(e,t){var o=Office.context.mailbox.item;o.body.getAsync("text",(function(n){if(n.status===Office.AsyncResultStatus.Failed)return console.error("Failed to get email body for keyword addition:",n.error),void t.completed();var i=n.value,r=o.conversationId&&o.conversationId.length>0;v(i,e,r,(function(e){if(!e||e.startsWith("API error:")||e.startsWith("Failed to generate enhanced email:")||e.startsWith("Error calling BotAtWork API:")){var n,i=e||"Unknown error occurred";console.error("Enhancement failed:",i);var r={type:Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,message:i.startsWith("API error:")||i.startsWith("Error calling BotAtWork API:")?"".concat(i," Send anyway?"):"Failed to enhance email: ".concat(i,". Send anyway?"),icon:"Icon.80x80",persistent:!0};null===(n=Office.context.mailbox.item)||void 0===n||n.notificationMessages.replaceAsync("ValidationNotification",r),t.completed()}else{var a=p(e);console.log("🔧 Converting markdown to HTML for send validation..."),o.body.setAsync(a,{coercionType:Office.CoercionType.Html},(function(e){e.status===Office.AsyncResultStatus.Succeeded?(console.log("Email enhanced with keywords, now sending..."),b(t)):(console.error("Failed to update email body:",e.error),t.completed())}))}}),{chooseATask:"emailWrite",tone:"professional",pointOfView:"organizationPerspective",additionalInstructions:"Quickly enhance the email with missing keywords and prepare it for sending while maintaining professional tone",anonymize:null,incognito:!1,default_language:"en-US",should_stream:!1})}))}(o.keywords,t):t.completed(),n.close()})),n.addEventHandler(Office.EventType.DialogEventReceived,(function(e){console.error("Dialog error:",e.error),t.completed()}))}))}(n,e):b(e)}))})),console.log("✅ sendWithValidation function registered"),console.log("🔧 Alternative ItemSend registration DISABLED"),window.testValidation=function(){console.log("🧪 Testing validation manually"),m({completed:function(e){console.log("✅ Test validation completed:",e)}})},window.resetValidationState=function(){console.log("🔄 Resetting validation state"),g={lastValidationTime:0,lastEmailBody:"",validationInProgress:!1},console.log("✅ Validation state reset:",g)},window.checkValidationState=function(){return console.log("📊 Current validation state:",g),g},window.checkValidationRegistration=function(){var e,t;console.log("🔍 Checking validation registration..."),console.log("✅ validateEmail function exists:",!0),console.log("✅ Office context available:",!!Office.context),console.log("✅ Mailbox available:",!(null===(e=Office.context)||void 0===e||!e.mailbox)),console.log("✅ Current validation state:",g),console.log("🎯 Last validation event:",window.lastValidationEvent),null!==(t=Office.context)&&void 0!==t&&null!==(t=t.mailbox)&&void 0!==t&&t.item?(console.log("✅ Email item accessible"),Office.context.mailbox.item.body.getAsync("text",(function(e){e.status===Office.AsyncResultStatus.Succeeded?console.log("✅ Email body accessible, length:",e.value.length):console.log("❌ Email body not accessible:",e.error)}))):console.log("❌ Email item not accessible")},window.testEventCompletion=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(console.log("🧪 Testing event completion with allowEvent:",e),window.lastValidationEvent){console.log("🎯 Using last validation event");try{window.lastValidationEvent.completed({allowEvent:e}),console.log("✅ Manual event.completed called successfully")}catch(e){console.error("❌ Error in manual event.completed:",e)}}else console.log("❌ No validation event available for testing")}}();
//# sourceMappingURL=commands.js.map